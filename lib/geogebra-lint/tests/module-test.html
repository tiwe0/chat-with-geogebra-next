<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Module Test</title>
</head>
<body>
    <h1>ES Module Import Test</h1>
    <div id="status">Loading...</div>
    <pre id="output"></pre>

    <script type="module">
        const output = document.getElementById('output');
        const status = document.getElementById('status');
        
        try {
            console.log('开始导入模块...');
            output.textContent += '开始导入模块...\n';
            
            const timestamp = Date.now();
            const module = await import(`../dist/index.js?v=${timestamp}`);
            
            console.log('模块加载成功！', module);
            output.textContent += '模块加载成功！\n';
            output.textContent += 'Available exports: ' + Object.keys(module).join(', ') + '\n';
            
            // 测试创建引擎
            const { RuleEngine, noUnknownCommand, correctArgTypes, LintSeverity } = module;
            const engine = new RuleEngine({
                rules: {
                    'no-unknown-command': 'error',
                    'correct-arg-types': 'warn'
                }
            });
            
            engine.registerRules([noUnknownCommand, correctArgTypes]);
            output.textContent += '\n规则引擎创建成功！\n';
            output.textContent += `注册了 ${engine.getRuleCount()} 个规则\n`;
            
            // 测试 lint
            const result = engine.lint('A = Point({0, 0})');
            output.textContent += `\nLint 测试成功！\n`;
            output.textContent += `错误: ${result.errorCount}, 警告: ${result.warningCount}\n`;
            
            status.textContent = '✅ 所有测试通过！';
            status.style.color = 'green';
            
        } catch (error) {
            console.error('错误:', error);
            output.textContent += '\n❌ 错误: ' + error.message + '\n';
            output.textContent += error.stack + '\n';
            status.textContent = '❌ 模块加载失败';
            status.style.color = 'red';
        }
    </script>
</body>
</html>
